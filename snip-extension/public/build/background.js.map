{"version":3,"file":"background.js","sources":["../../src/background.js"],"sourcesContent":["let toggleAdd = false;\nlet currentSelection = \"\";\n\nchrome.runtime.onInstalled.addListener(() => {\n  console.log(\"INSTALLED\");\n  chrome.storage.local.set({ snipSearchBar: false });\n});\n\nfunction sendQuoteToServer(sourceURL, title, quote) {\n  (async () => {\n    const response = await fetch(\"http://127.0.0.1:8080/add-quote\", {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        quote: currentSelection,\n        source: sourceURL,\n        description: title,\n        tags: [\"\"],\n      }),\n    });\n    // ADD ERROR HANDLING\n  })();\n}\n\nfunction sendBookmarkToServer(sourceUrl, linkUrl) {\n  console.log(\"SOURCE:\", sourceUrl);\n  console.log(\"LINK\", linkUrl);\n  (async () => {\n    const response = await fetch(\"http://127.0.0.1:8080/add-bookmark\", {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        link: linkUrl,\n        source: sourceUrl,\n        description: \"\",\n        tags: [\"\"],\n      }),\n    })\n      .then(res => {\n        console.log(\"success: \", res);\n        return res;\n      })\n      .catch(err => {\n        console.log(\"error\");\n      });\n\n    // ADD ERROR HANDLING\n  })();\n}\n\nfunction sendImageToServer(title, imageUrl, sourceUrl) {\n  (async () => {\n    const response = await fetch(\"http://127.0.0.1:8080/add-image\", {\n      method: \"POST\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        url: imageUrl,\n        source: sourceUrl,\n        description: title,\n        tags: [\"\"],\n      }),\n    })\n      .then(res => {\n        console.log(\"success\");\n        return res;\n      })\n      .catch(err => {\n        console.log(\"error\");\n      });\n    // ADD ERROR HANDLING\n  })();\n}\n\n/* GRAB QUOTE */\nasync function snipHandlerQuote(snip, tab) {\n  console.log(\"Quote\");\n  await sendQuoteToServer(tab.url, tab.title, snip.selectionText);\n}\n\nasync function snipHandlerImage(snip, tab) {\n  console.log(\"Image\");\n  await sendImageToServer(tab.title, snip.srcUrl, snip.pageUrl);\n}\n\nasync function snipHandlerBookmark(snip, tab) {\n  console.log(\"Bookmark\");\n  await sendBookmarkToServer(tab.url, snip.linkUrl);\n}\n\nchrome.runtime.onInstalled.addListener(function () {\n  chrome.contextMenus.removeAll();\n\n  chrome.contextMenus.create({\n    type: \"normal\",\n    contexts: [\"selection\"],\n    id: \"snipHandlerQuote\",\n    title: \"Snip quote\",\n  });\n\n  chrome.contextMenus.create({\n    type: \"normal\",\n    contexts: [\"image\"],\n    id: \"snipHandlerImage\",\n    title: \"Snip image\",\n  });\n\n  chrome.contextMenus.create({\n    type: \"normal\",\n    contexts: [\"link\"],\n    id: \"snipHandlerBookmark\",\n    title: \"Snip link\",\n  });\n});\n\nchrome.contextMenus.onClicked.addListener(async function (snip) {\n  await console.log(\"Here\", snip);\n  let tab = await getTab();\n  console.log(\"Tag\");\n  // chrome.scripting\n  //   .executeScript({\n  //     target: { tabId: tab.id },\n  //     func: await findElement,\n  //     args: [info.mediaType, info.srcUrl],\n  //   })\n  //   .then(res => {\n  //     console.log(\"sadsfkjadf\", res.result);\n  //   });\n  if (\"selectionText\" in snip) {\n    console.log(\"snipping quote\");\n    await snipHandlerQuote(snip, tab);\n  } else if (\"mediaType\" in snip) {\n    if (snip.mediaType === \"image\") {\n      console.log(\"snipping image\", snip);\n      await snipHandlerImage(snip, tab);\n    }\n  } else {\n    console.log(\"snipping link\");\n    await snipHandlerBookmark(snip, tab);\n  }\n});\n// this function's code will be executed as a content script in the web page\nfunction findElement(mediaType, srcUrl) {\n  const tagName = mediaType === \"image\" ? \"img\" : mediaType;\n  for (const el of document.querySelectorAll(tagName)) {\n    if (el.src === srcUrl) {\n      console.log(el);\n      return el.alt;\n    }\n  }\n  return null;\n}\n\nasync function getTab() {\n  let queryOptions = { active: true, currentWindow: true };\n  let tab = await chrome.tabs.query(queryOptions);\n  return tab[0];\n}\n\nasync function processKeypress() {}\n\nchrome.commands.onCommand.addListener(async command => {\n  console.log(`Command \"${command}\" triggered`);\n  getTab().then(async tab => {\n    console.log(\"Here\");\n    chrome.tabs.sendMessage(tab.id, \"toggle-search\", function (response) {\n      console.log(response);\n    });\n  });\n});\n\nchrome.runtime.onMessage.addListener((message, sender, sendMessage) => {\n  console.log(message);\n  if (message.status === \"updateSelection\") {\n    currentSelection = message.selection;\n    console.log(\"CS\", currentSelection);\n  } else {\n    console.log(\"msg\", message, sender, sendMessage);\n  }\n});\n"],"names":[],"mappings":"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"}